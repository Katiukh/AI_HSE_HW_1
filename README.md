# Предсказание стоимости автомобиля
## Ссылка на приложение
https://carpredictionapplr.streamlit.app/
## Предобрабокта данных
### Обработка единиц измерения
На начальном этапе были убраны единицы измерения у следующих переменных:
- max_power: убрала bhp;
- mileage: убрала kmpl или сначала перевела km/kg в kmpl с помощью плотности и уже затем убрала единицы измерения;
- torque: разделила на две переменные: torque и max_torque_prm переведя единицы измерения, где нужно, а затем их убрала;
- engine: убрала единицы измерения.
### Удаление дубликатов
Были удалены дубликаты с одинаковым признаковым описанием (оставлена только первая строчка).
### Обработка пропусков
Пропуски в mileage, engine, max_power, torque, seats, max_torque_rpm заполнены медианой.
### Приведение к корректным типам данных
mileage, max_power и torque приведены к float, engine к int, seats к str 
### Масштабирование
Масштабирование вещественных признаков через StandardScaler
### Кодирование ктаегориалных признаков
Применено one-hot кодирование
## Анализ описательных статистик датасета 
### До удаления пропусков и дубликатов
Распределения train и test довольно похожи, что делает вероятность переобучения небольшой. Также, обнаружены возможные выбросы в трейне в признаках max_torque_rpm (21.800), km_driven (2.36 млн км).
### После удаления пропусков и дубликатов
- Произошло явное смещение в переменной selling_price: средняя цена упала на 18%, медиана на 10%
- km_driven: среднее увеличилось 6.3%, медиана на 16.7%
-Переменные, пропуски в которых заполнены медианой практически не имзенились:
-Наибольшее смещение: torque (-4.38% медиана) и max_torque_rpm (-6.67% медиана)
## Анализ визуализаций/корреляций
### Анализ pairplot
По графику видно, что selling_price связана с year, km_driven, engine, max_power, torque. Но в случае с year и km_driven зависимость выглядит нелинейной.
### Корреляция
#### Корреляция Пирсона
Высокие корреляции с selling price: torque (0.61) и max_power (0.69)
#### Корреляция Спирмена
Высокие корреляции с selling price: torque (0.61) и max_power (0.61), year(0.71)
#### phik
Высокие корреляции с selling price: torque (0.75) и max_power (0.87), mileage(0.65)
## Обученные модели
### Только на вещественных признаках
#### Linear Regression (данные не отмасштабированны)
**Результат:**

R2 на трейне: 0.600816471694982\
MSE на трейне: 114421303253.18874

R2 на тесте: 0.5965493310152009\
MSE на тесте: 231914965323.89618

**Выводы:**

Достаточно неплохой R2, причем разница между train и test небольшая
Нет переобучения
Огромный MSE, причем на тесте в два раза больше
#### Linear Regression 
R2 на трейне: 0.6008164716949826\
MSE на трейне: 114421303253.18857

R2 на тесте: 0.5965493310152044\
MSE на тесте: 231914965323.89423
#### Lasso Default
R2 на трейне: 0.600816471621797\
MSE на трейне: 114421303274.16635

R2 на тесте: 0.5965481986902721\
MSE на тесте: 231915616216.59952
#### Lasso GSCV
alpha: 1000.0\
max_iter: 100

R2 на трейне: 0.6007405488792036\
MSE на трейне: 114443065642.94691

R2 на тесте: 0.5953728306202068\
MSE на тесте: 232591251346.65872
#### Elastic Net GSCV
alpha: 1.0\
l1_ratio: 0.9\
max_iter: 1000

R2 на трейне: 0.5950237252710038\
MSE на трейне: 116081726462.68643

R2 на тесте: 0.5744263780381093\
MSE на тесте: 244631870430.175

#### Ridge GSCV + категориальные фичи
alpha = 2

R2 на трейне: 0.7690726115516349\
MSE на трейне: 66192642906.165596

R2 на тесте: 0.7780211696921479\
MSE на тесте: 127599770408.174

## Feature Engineering
Добавлены год и пробег в квадрате

Результаты: (Ridge(alpha=0.21)): 

R2 на трейне: 0.7908437753236677\
MSE на трейне: 59952192698.43271

R2 на тесте: 0.7988925265933171\
MSE на тесте: 115602318466.46042

Модель стабильно улучшилась на всех метриках

# Вывод
- Наибольший буст дали категориальные переменные (~20%)
    - А именно, самыми важными фичами оказались названия => представленные марки автомобилей сильно отличаются по ценам
- Год и пробег в квадрате ~2%
- Мастшабирование данных не оказало большого влияния
- Не вошедшее в ipynb (неудачное, удалено):
    - Можно было бы улучшить модель до R2 = 0.97 при сохранении полного name. Но мне показалось, что так делать некорректно, потому что на вход модели могут дать новое название и тогда она не будет работать (такой категории не было при обучении);
    - Добавляла другие переменные в квадрате (max_power, torque, mileage). Качество на трейне сильно упало, а на тесте не изменилось;
    - Я также проверяла другие модели с категориальными переменными, но они хуже/не сильно отличаются, поэтому лучшая модель в итоге выбарана Ridge.